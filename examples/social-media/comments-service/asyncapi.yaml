asyncapi: 3.0.0
info:
  title: Comments Service
  version: 1.0.0
  description: This service is in charge of processing all the events related to comments.
servers:
  mosquitto:
    host: test.mosquitto.org
    protocol: mqtt
    tags:
      - name: 'env:production'
        description: This environment is meant for production use case
      - name: 'kind:remote'
        description: This server is a remote server. Not exposed by the application
      - name: 'visibility:public'
        description: This resource is public and available to everyone
    bindings:
      mqtt:
        clientId: comment-service
channels:
  comment/liked:
    address: comment/liked
    messages:
      publish.message:
        $ref: ../common/messages.yaml#/commentLiked
    description: >-
      Updates the likes count in the database and sends the new count to the
      broker.
  'comment/{commentId}/changed':
    address: 'comment/{commentId}/changed'
    messages:
      subscribe.message:
        $ref: ../common/messages.yaml#/commentChanged
    description: >-
      Sends the new count to the broker after it has been updated in the
      database.
    parameters:
      commentId: {}
operations:
  comment/liked.publish:
    action: receive
    channel:
      $ref: '#/channels/comment~1liked'
    messages:
      - $ref: ../common/messages.yaml#/commentLiked
  'comment/{commentId}/changed.subscribe':
    action: send
    channel:
      $ref: '#/channels/comment~1{commentId}~1changed'
    messages:
      - $ref: ../common/messages.yaml#/commentChanged
